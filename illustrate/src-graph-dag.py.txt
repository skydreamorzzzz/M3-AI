一、文件核心定位
该文件是通用图工具模块，聚焦 “纯图算法处理”（不负责建图规则，建图由 build_drg 模块完成），核心功能与目标：
提供通用图处理能力：边格式归一化、去环（转 DAG）、拓扑排序；
核心目标：将 dependency 图转换为可拓扑排序的有向无环图（DAG），为调度器输出合法的执行顺序；
模块特性：纯算法层、无业务逻辑依赖、无数据修改副作用。
二、对外接口
提供 3 个核心函数，覆盖 “标准化→去环→排序” 全流程，接口信息如下：
函数名	核心作用
normalize_edges	统一各类边的表示格式为标准 (src, dst) 元组，同时过滤非法边、去重、去自环
break_cycles	检测并删除图中的环，将非 DAG 转换为合法 DAG
topo_sort	对 DAG 执行拓扑排序，输出节点执行顺序
三、核心实现思路（典型使用流程）
三个函数配合完成图处理，为调度器输出合法执行顺序，流程如下：
标准化：调用 normalize_edges 统一边格式，清理无效边；
去环：调用 break_cycles 消除图中环，得到无环的 DAG；
排序：调用 topo_sort 对 DAG 做拓扑排序，输出最终执行顺序。
四、各功能详细说明
1. normalize_edges（边格式标准化）
核心目标：消除边格式差异，输出干净、统一的标准边列表；
支持的输入格式：
基础元组：(u, v)；
字典形式：含 src/dst、from/to 等关键字的字典；
数据类对象：含 source/target 等字段的 dataclass 对象；
额外数据清洗：
过滤空值、无效节点等非法边；
移除自环（如 (u, u) 形式的边）；
对边列表去重，避免重复边干扰后续计算。
2. break_cycles（图去环，生成 DAG）
核心目标：将含环的图转换为无环的 DAG，保证拓扑排序可行；
核心策略（迭代去环）：
尝试对当前图做拓扑排序，失败则判定存在环；
定位环的具体节点和边；
删除环中 “权重最低” 的边（优先移除影响最小的边）；
重复 1-3 步骤，直到图无环；
输出内容：
去环后的合法边列表（DAG）；
被删除的边列表（便于追溯环的处理过程）。
3. topo_sort（拓扑排序）
核心算法：采用 Kahn 算法实现拓扑排序；
执行逻辑：
计算所有节点的入度；
从入度为 0 的节点开始遍历；
遍历过程中逐步删除节点关联的边，更新剩余节点入度；
最终输出线性的节点执行顺序；
异常处理（图仍含环时）：
默认返回 None，明确提示排序失败；
若设置 return_partial=True，则返回当前能排序出的部分节点顺序。
五、设计特点
通用性：不依赖具体业务逻辑，可复用于任意图结构的处理；
无侵入性：仅处理边的关系，不修改原始节点的结构和数据；
纯算法层：仅做图的计算和转换，无数据修改、无副作用；
鲁棒性：包含非法边过滤、环检测 / 处理等防御式设计，适配各类异常情况。
六、核心总结
该模块是 “图驱动调度” 的底层算法支撑，核心提供边标准化、图去环、拓扑排序三大能力；
函数配合使用可将任意非标准含环图，转换为可排序的合法 DAG，输出调度器所需的执行顺序；
模块通用、无业务依赖，仅聚焦图算法处理，无副作用。